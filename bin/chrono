#!/bin/bash
CMD=$1
NOW="${*:2}"

TIMELOGDIR="$HOME/.timelog"
mkdir -p $TIMELOGDIR

if [ -z $CMD ] ; then
	CMD=summary
fi

case $CMD in
	summary)
		DAY=`date +%Y-%m-%d`
		TIMEFILE=$TIMELOGDIR/$DAY.log

		touch $TIMEFILE
		sort $TIMEFILE | while read L; do
			TASK=`echo "$L" | cut -s -f2`
			TIME=`echo "$L" | cut -s -f1`
			if [ ! -z $PREVTIME ] ; then
				DELTASEC=$((TIME-PREVTIME))
				DELTAHOURS=`echo "$DELTASEC/3600" | bc -l`
				printf "%s - %03.1f\n" $PREVTASK $DELTAHOURS
			fi
			PREVTIME=$TIME
			PREVTASK=$TASK
		done
		printf "Now: %s - Since: %s\n"\
		 $(tail -n 1 $TIMEFILE | cut -s -f2)\
		 $(date --date="@$(tail -n 1 $TIMEFILE | cut -s -f1)" +%T)
		;;
	*)
		DAY=`date --date="${*:2}" +%Y-%m-%d`
		TIMEFILE=$TIMELOGDIR/$DAY.log

		touch $TIMEFILE
		echo -e "$(date --date="${*:2}" +%s)\t$1" >> $TIMEFILE
		;;
esac
