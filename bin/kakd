#!/bin/bash

if [[ -n KAK_SESSION ]]; then
    KAK_SESSION=$(basename `pwd`)
fi
KAK_SESSION=${KAK_SESSION#.}
socket_file=$(kak -l | grep $KAK_SESSION)

if [[ $socket_file == "" ]]; then        
    # Create new kakoune daemon for current dir
    kak -d -s $KAK_SESSION
fi

# and run kakoune (with any arguments passed to the script)
kak -c $KAK_SESSION $@
